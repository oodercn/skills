# SDK 0.8.0 升级协作任务

## 文档信息

| 项目 | 值 |
|------|-----|
| 版本 | v0.8.0 |
| 创建日期 | 2026-02-23 |
| 负责团队 | Ooder SDK Team |
| 关联项目 | [ooder-sdk/agent-sdk](https://github.com/ooderCN/ooder-sdk) |
| 协议文档 | [v0.8.0 架构设计](./ARCHITECTURE-V0.8.0.md) |

---

## 一、项目概述

### 1.1 升级目标

将 Ooder Agent SDK 从 0.7.3 升级到 0.8.0，实现以下核心能力：

1. **CAP 驱动架构**：建立标准化的能力注册表和契约验证
2. **Scene = Agent**：场景作为特殊的智能体，具备完整的 Agent 属性
3. **Workflow 编排**：支持复杂用户故事的流程化执行
4. **离线优先**：强制降级实现，保障网络不稳定时的连续性
5. **多 Agent 协同**：完整的 Agent 层次结构和协作机制

### 1.2 现有实现评估

| 模块 | 现有状态 | 复用度 | 升级方向 |
|------|----------|--------|----------|
| 发现机制 | 9种发现方法 | ✅ 100% | 无需修改 |
| Agent 体系 | McpAgent/RouteAgent/EndAgent | 🔄 60% | 新增 SceneAgent/WorkerAgent |
| 能力中心 | CapabilityCenter | 🔄 50% | 适配 CAP 地址空间 |
| 场景管理 | SceneManager | 🔄 40% | 增强 Workflow 编排 |
| 离线服务 | OfflineService | 🔄 50% | 增强降级策略 |
| 安全机制 | SecurityService | ✅ 80% | 小幅扩展 |

---

## 二、任务分解与分工

### 阶段一：核心架构升级（第1-4周）

#### 模块 A：CAP 注册表

**负责人**：`@待分配`  
**工作量**：10人天  
**优先级**：P0（最高）

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| CAP-001 | 创建 CAP 地址空间枚举（00-FF） | ⏳ 待开始 | - | - | - |
| CAP-002 | 实现 cap.yaml 解析器 | ⏳ 待开始 | - | - | - |
| CAP-003 | 实现 cap.md 文档加载器 | ⏳ 待开始 | - | - | - |
| CAP-004 | 实现 CapRegistry 接口和实现类 | ⏳ 待开始 | - | - | - |
| CAP-005 | 实现 CAP 契约验证器 | ⏳ 待开始 | - | - | - |
| CAP-006 | 实现 CAP 版本管理器 | ⏳ 待开始 | - | - | - |
| CAP-007 | 集成到 CapabilityCenter | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.cap.*` 包
- CAP 注册表 API 文档
- 单元测试覆盖率 ≥ 80%

---

#### 模块 B：SceneAgent 实现

**负责人**：`@待分配`  
**工作量**：9人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| AGENT-001 | 扩展 Agent 接口，增加 SceneAgent 特有属性 | ⏳ 待开始 | - | - | - |
| AGENT-002 | 实现 SceneAgentImpl | ⏳ 待开始 | - | - | - |
| AGENT-003 | 实现 Agent 状态流转（INITIALIZING→ACTIVE→SUSPENDED→STOPPED） | ⏳ 待开始 | - | - | - |
| AGENT-004 | 实现 Agent 类型（PRIMARY/BACKUP/COLLABORATIVE） | ⏳ 待开始 | - | - | - |
| AGENT-005 | 实现 SceneGroup 故障切换 | ⏳ 待开始 | - | - | - |
| AGENT-006 | 集成到 AgentFactory | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.api.agent.SceneAgent` 接口
- `net.ooder.sdk.core.agent.impl.SceneAgentImpl` 实现
- Agent 状态流转图文档

---

#### 模块 C：WorkerAgent 实现

**负责人**：`@待分配`  
**工作量**：7人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| WORKER-001 | 定义 WorkerAgent 接口 | ⏳ 待开始 | - | - | - |
| WORKER-002 | 实现 WorkerAgentImpl（封装 Skill + CapProvider） | ⏳ 待开始 | - | - | - |
| WORKER-003 | 实现设备选择策略 | ⏳ 待开始 | - | - | - |
| WORKER-004 | 实现任务执行和状态管理 | ⏳ 待开始 | - | - | - |
| WORKER-005 | 集成到 SceneAgent | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.api.agent.WorkerAgent` 接口
- `net.ooder.sdk.core.agent.impl.WorkerAgentImpl` 实现

---

#### 模块 D：Workflow 引擎

**负责人**：`@待分配`  
**工作量**：12人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| WF-001 | 定义 WorkflowDefinition 模型 | ⏳ 待开始 | - | - | - |
| WF-002 | 定义 WorkflowStep 模型 | ⏳ 待开始 | - | - | - |
| WF-003 | 实现 WorkflowEngine 接口 | ⏳ 待开始 | - | - | - |
| WF-004 | 实现步骤依赖解析器 | ⏳ 待开始 | - | - | - |
| WF-005 | 实现顺序执行器 | ⏳ 待开始 | - | - | - |
| WF-006 | 实现并行执行器 | ⏳ 待开始 | - | - | - |
| WF-007 | 实现条件执行器 | ⏳ 待开始 | - | - | - |
| WF-008 | 实现 WorkflowContext | ⏳ 待开始 | - | - | - |
| WF-009 | 集成到 SceneManager | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.workflow.*` 包
- Workflow 执行流程文档
- 示例场景配置

---

### 阶段二：协议与通信升级（第5-7周）

#### 模块 E：Command 体系

**负责人**：`@待分配`  
**工作量**：7人天  
**优先级**：P1

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| CMD-001 | 定义 Command 模型（标准命令/自定义命令） | ⏳ 待开始 | - | - | - |
| CMD-002 | 实现 CommandBuilder | ⏳ 待开始 | - | - | - |
| CMD-003 | 实现 CommandRouter | ⏳ 待开始 | - | - | - |
| CMD-004 | 实现标准命令处理器 | ⏳ 待开始 | - | - | - |
| CMD-005 | 实现自定义命令处理器 | ⏳ 待开始 | - | - | - |
| CMD-006 | 集成到 CapabilityInvoker | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.command.*` 包
- Command 规范文档

---

#### 模块 F：设备绑定管理

**负责人**：`@待分配`  
**工作量**：5人天  
**优先级**：P1

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| BIND-001 | 定义 DeviceBinding 模型 | ⏳ 待开始 | - | - | - |
| BIND-002 | 实现 BindingManager 接口 | ⏳ 待开始 | - | - | - |
| BIND-003 | 实现强绑定/弱绑定逻辑 | ⏳ 待开始 | - | - | - |
| BIND-004 | 实现设备更换流程 | ⏳ 待开始 | - | - | - |
| BIND-005 | 集成到 Agent 管理 | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.binding.*` 包
- 设备绑定流程文档

---

#### 模块 G：心跳与状态管理

**负责人**：`@待分配`  
**工作量**：6人天  
**优先级**：P1

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| HB-001 | 扩展现有心跳机制，支持设备分类 | ⏳ 待开始 | - | - | - |
| HB-002 | 实现设备类型心跳策略 | ⏳ 待开始 | - | - | - |
| HB-003 | 实现状态恢复机制（离线→重新入网） | ⏳ 待开始 | - | - | - |
| HB-004 | 实现故障检测和隔离 | ⏳ 待开始 | - | - | - |
| HB-005 | 集成到 OfflineService | ⏳ 待开始 | - | - | - |

**交付物**：
- 增强的 `OfflineService`
- 心跳策略配置文档

---

#### 模块 H：北向/南向协议分层

**负责人**：`@待分配`  
**工作量**：8人天  
**优先级**：P1

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| PROTO-001 | 定义北向协议接口 | ⏳ 待开始 | - | - | - |
| PROTO-002 | 定义南向协议接口 | ⏳ 待开始 | - | - | - |
| PROTO-003 | 实现北向协议消息处理 | ⏳ 待开始 | - | - | - |
| PROTO-004 | 实现南向协议消息处理 | ⏳ 待开始 | - | - | - |
| PROTO-005 | 实现协议消息编解码 | ⏳ 待开始 | - | - | - |
| PROTO-006 | 集成到现有协议体系 | ⏳ 待开始 | - | - | - |

**交付物**：
- `net.ooder.sdk.protocol.northbound.*` 包
- `net.ooder.sdk.protocol.southbound.*` 包
- 协议规范文档

---

### 阶段三：配置与文档（第8周）

#### 模块 I：配置规范升级

**负责人**：`@待分配`  
**工作量**：3.5人天  
**优先级**：P2

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| CFG-001 | 扩展 SDKConfiguration 支持 0.8.0 配置 | ⏳ 待开始 | - | - | - |
| CFG-002 | 实现 scene.yaml 解析器 | ⏳ 待开始 | - | - | - |
| CFG-003 | 实现 skill-manifest.yaml 扩展解析 | ⏳ 待开始 | - | - | - |
| CFG-004 | 更新默认配置文件 | ⏳ 待开始 | - | - | - |

---

#### 模块 J：文档更新

**负责人**：`@待分配`  
**工作量**：3.5人天  
**优先级**：P2

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| DOC-001 | 更新 README.md | ⏳ 待开始 | - | - | - |
| DOC-002 | 编写 SDK_0.8.0_UPGRADE_GUIDE.md | ⏳ 待开始 | - | - | - |
| DOC-003 | 更新架构文档 | ⏳ 待开始 | - | - | - |
| DOC-004 | 编写 API 参考文档 | ⏳ 待开始 | - | - | - |

---

### 阶段四：测试与验证（第9-10周）

#### 模块 K：单元测试

**负责人**：`@待分配`  
**工作量**：8人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| TEST-001 | CAP 注册表单元测试 | ⏳ 待开始 | - | - | - |
| TEST-002 | SceneAgent 单元测试 | ⏳ 待开始 | - | - | - |
| TEST-003 | WorkerAgent 单元测试 | ⏳ 待开始 | - | - | - |
| TEST-004 | Workflow 引擎单元测试 | ⏳ 待开始 | - | - | - |
| TEST-005 | Command 体系单元测试 | ⏳ 待开始 | - | - | - |
| TEST-006 | 设备绑定单元测试 | ⏳ 待开始 | - | - | - |

---

#### 模块 L：集成测试

**负责人**：`@待分配`  
**工作量**：6人天  
**优先级**：P0

| 任务ID | 任务描述 | 状态 | 负责人 | 预计完成 | 实际完成 |
|--------|----------|------|--------|----------|----------|
| INT-001 | CAP 契约验证集成测试 | ⏳ 待开始 | - | - | - |
| INT-002 | 场景工作流集成测试 | ⏳ 待开始 | - | - | - |
| INT-003 | 离线模式集成测试 | ⏳ 待开始 | - | - | - |
| INT-004 | 多 Agent 协同测试 | ⏳ 待开始 | - | - | - |

---

## 三、里程碑计划

| 里程碑 | 版本 | 目标日期 | 主要内容 | 状态 |
|--------|------|----------|----------|------|
| M1 | 0.8.0-alpha1 | 2026-03-08 | CAP 注册表 + SceneAgent | ⏳ 进行中 |
| M2 | 0.8.0-alpha2 | 2026-03-22 | WorkerAgent + Workflow 引擎 | 🔒 未开始 |
| M3 | 0.8.0-beta1 | 2026-04-05 | Command 体系 + 设备绑定 | 🔒 未开始 |
| M4 | 0.8.0-rc1 | 2026-04-19 | 北向/南向协议 + 文档 | 🔒 未开始 |
| M5 | 0.8.0 | 2026-05-03 | 测试完成 + 正式发布 | 🔒 未开始 |

---

## 四、风险与依赖

### 4.1 技术风险

| 风险ID | 风险描述 | 影响 | 概率 | 缓解措施 | 负责人 |
|--------|----------|------|------|----------|--------|
| R001 | CAP 契约验证复杂度高 | 延迟 M1 | 中 | 先实现基础验证，后续迭代增强 | - |
| R002 | Workflow 并行执行器实现复杂 | 延迟 M2 | 中 | 参考成熟框架设计 | - |
| R003 | 离线模式状态同步 | 数据一致性 | 低 | 设计完善的状态机，增加测试覆盖 | - |
| R004 | 多 Agent 协同复杂度 | 延迟测试 | 中 | 提前进行架构评审 | - |

### 4.2 外部依赖

| 依赖ID | 依赖项 | 说明 | 状态 | 负责人 |
|--------|--------|------|------|--------|
| D001 | skills 仓库 0.8.0 协议文档 | CAP 定义、场景规范 | ✅ 已完成 | - |
| D002 | ooder-common VFS 集成 | 数据中心存储 | ⏳ 待确认 | - |
| D003 | SkillCenter API | 技能发现和安装 | ⏳ 待确认 | - |

---

## 五、沟通与协作

### 5.1 会议安排

| 会议类型 | 频率 | 参与人 | 目的 |
|----------|------|--------|------|
| 每日站会 | 每日 10:00 | 全体成员 | 进度同步、问题暴露 |
| 周例会 | 每周五 15:00 | 全体成员 | 周进度总结、下周计划 |
| 技术评审 | 按需 | 相关开发人员 | 方案评审、技术决策 |
| 里程碑评审 | 里程碑结束时 | 全体成员 + 干系人 | 里程碑验收、下阶段规划 |

### 5.2 沟通渠道

| 渠道 | 用途 | 链接 |
|------|------|------|
| GitHub Issues | 问题跟踪、任务分配 | [Issues](https://github.com/ooderCN/ooder-sdk/issues) |
| GitHub PR | 代码评审 | [Pull Requests](https://github.com/ooderCN/ooder-sdk/pulls) |
| 钉钉群 | 日常沟通 | - |
| Wiki | 文档沉淀 | - |

### 5.3 代码规范

- **分支命名**：`feature/模块名-任务ID`，如 `feature/cap-CAP-001`
- **提交信息**：`[模块名] 任务ID: 描述`，如 `[CAP] CAP-001: 添加 CAP 地址空间枚举`
- **PR 要求**：
  - 关联 Issue
  - 单元测试通过
  - 代码评审通过（至少 1 人）
  - 无 SonarQube 严重问题

---

## 六、进度统计

### 6.1 总体进度

| 指标 | 数值 |
|------|------|
| 总任务数 | 58 |
| 已完成 | 0 |
| 进行中 | 0 |
| 待开始 | 58 |
| 完成率 | 0% |

### 6.2 模块进度

| 模块 | 总任务 | 已完成 | 进度 |
|------|--------|--------|------|
| A: CAP 注册表 | 7 | 0 | 0% |
| B: SceneAgent | 6 | 0 | 0% |
| C: WorkerAgent | 5 | 0 | 0% |
| D: Workflow 引擎 | 9 | 0 | 0% |
| E: Command 体系 | 6 | 0 | 0% |
| F: 设备绑定 | 5 | 0 | 0% |
| G: 心跳管理 | 5 | 0 | 0% |
| H: 北向/南向协议 | 6 | 0 | 0% |
| I: 配置规范 | 4 | 0 | 0% |
| J: 文档更新 | 4 | 0 | 0% |
| K: 单元测试 | 6 | 0 | 0% |
| L: 集成测试 | 4 | 0 | 0% |

---

## 七、变更记录

| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|----------|--------|
| 2026-02-23 | v1.0 | 初始版本，创建协作任务文档 | - |

---

## 八、附录

### 8.1 相关文档链接

- [架构设计总览](./ARCHITECTURE-V0.8.0.md)
- [CAP 注册表规范](./CAP-REGISTRY-SPEC.md)
- [场景引擎规范](./SCENE-ENGINE-SPEC.md)
- [能力发现协议](./CAPABILITY-DISCOVERY-PROTOCOL.md)

### 8.2 技术参考

- [Ooder Agent SDK 仓库](https://github.com/ooderCN/ooder-sdk)
- [Ooder Skills 仓库](https://github.com/ooderCN/skills)
- [Spring Boot 文档](https://docs.spring.io/spring-boot/docs/2.7.0/reference/html/)

---

**最后更新**：2026-02-23
